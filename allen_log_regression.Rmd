---
title: "Stats 2 Project 2"
author: "Allen Hoskins"
date: "3/23/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Package Setup}
library(tidyverse)
library(naniar)
library(magrittr)
library(readr)
library(glmnet)
library(caret)
library(plotmo)
library(boot)
library(MASS)
```

```{r Read in Data Set}
df = read.csv(file.choose(),header = TRUE)
df
#df = df %>% filter(df$balance != 0)
df$y <- as.factor(df$y)
df$job = factor(df$job)
df$marital = factor(df$marital)
df$education = factor(df$education)
df$default = factor(df$default)
df$housing = factor(df$housing)
df$loan = factor(df$loan)
df$contact = factor(df$contact)
df$poutcome = factor(df$poutcome)
df$month = factor(df$month)

#df$y = ifelse(df$y =="yes",1,0)
```

```{r Train/Test Split}

## 75% of the sample size
smp_size <- floor(0.80 * nrow(df))

## set the seed to make your partition reproducible
set.seed(1235324)
train_ind <- sample(seq_len(nrow(df)), size = smp_size)

train_df <- df[train_ind, ]
test_df <- df[-train_ind, ]



```


```{r breaking response and explinatory}
#defining response variable
train_resp = train_df$y
test_resp = test_df$y

#recode yes/no to 1 and 0
#train_resp = ifelse(train_resp =="yes",1,0)
#test_resp = ifelse(test_resp =="yes",1,0)

#defining explanatory variables
train_expl = data.matrix(train_df[,1:16])
test_expl = data.matrix(test_df[,1:16])

```

```{r simple model}

df[46,]

prop.table(table(df$y))
```

```{r LASSO}

#cv model
cv_model = cv.glmnet(train_expl,train_resp, family = 'binomial')
best_lambda = cv_model$lambda.min
best_lambda

#plot cv model
plot(cv_model)



#lasso model
best_model = glmnet(train_expl,train_resp, lambda = best_lambda,family = 'binomial')
coef(best_model,best_lambda)

```


```{r ASSESS LASSO MODEL}
#assess lasso model
assess.glmnet(best_model,test_expl,test_resp, family = 'binomial',s = best_lambda)
#return confusion matrix from lasso model
confusion.glmnet(best_model,test_expl,test_resp,family = 'binomial',s=best_lambda)
#plot roc curve from lasso model
plot(roc.glmnet(best_model,test_expl,test_resp,family = 'binomial',s=best_lambda))

```
