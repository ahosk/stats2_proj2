---
title: "Stats 2 Project 2"
author: "Allen Hoskins"
date: "3/23/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Package Setup}
library(tidyverse)
library(naniar)
library(magrittr)
library(readr)
library(glmnet)
library(caret)
library(plotmo)
```

```{r Read in Data Set}
df = read.csv(file.choose(),header = TRUE)
head(df)

df$y <- as.factor(df$y)
```

```{r Train/Test Split}

## 75% of the sample size
smp_size <- floor(0.80 * nrow(df))

## set the seed to make your partition reproducible
set.seed(123)
train_ind <- sample(seq_len(nrow(df)), size = smp_size)

train_df <- df[train_ind, ]
test_df <- df[-train_ind, ]

ctrl <- trainControl(method = "cv", number = 10, classProbs = TRUE)
```


```{r Simple Logistic Regression}

```

```{r Variable Importance}
log_imp = varImp(log_fit, scale = FALSE, competes = FALSE)
log_imp
```

```{r Prediction on Simple Logistric Regression}
pred_log <- predict(log_fit, newdata = test_df)
confusionMatrix(pred_log, test_df$y)

plot_glmnet(lasso.mod, label=5,nresponse = 3) 
```



```{r LASSO}

glimpse(expl)
glimpse(resp)
#defining response variable
train_resp = train_df$y
test_resp = test_df$y

#recode yes/no to 1 and 0
train_resp = ifelse(train_resp =="yes",1,0)
test_resp = ifelse(test_resp =="yes",1,0)

#defining explanatory variables
train_expl = data.matrix(train_df[,1:16])
test_expl = data.matrix(test_df[,1:16])


#simple log regression
simple_log_fit = glm(train_resp ~ train_expl[,1:16],family = binomial)
summary(simple_log_fit)
plot(simple_log_fit)
#simple lasso log regression

simple_model = glmnet(train_expl,train_resp,alpha = 1,family = 'binomial')
plot_glmnet(simple_model,label=5,nresponse =3)
simple_model$lambda.min

#cv model
cv_model = cv.glmnet(train_expl,train_resp,alpha = 1, family = 'binomial')
best_lambda = cv_model$lambda.min
best_lambda

#plot cv model
plot(cv_model)



#lasso model
best_model = glmnet(train_expl,train_resp,alpha = 1, labmda = best_lambda,family = 'binomial')
best_model
coef(best_model,best_lambda)

```


```{r Better Simple Linear Regression}
#assess lasso model
assess.glmnet(best_model,test_expl,test_resp, family = 'binomial',s = best_lambda)
#return confusion matrix from lasso model
confusion.glmnet(best_model,test_expl,test_resp,family = 'binomial',s=best_lambda)
#plot roc curve from lasso model
plot(roc.glmnet(best_model,test_expl,test_resp,family = 'binomial',s=best_lambda))

```
